<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Briz - Le jeu pour brizer la glace</title>
    <meta name="description" content="Briz - Le jeu pour brizer la glace.">
    <meta name="theme-color" content="#111827" />
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel to transpile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #111827;
        }
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fade-in-fast { from { opacity: 0; } to { opacity: 1; } }
        .animate-fade-in { animation: fade-in 0.5s ease-out forwards; }
        .animate-fade-in-fast { animation: fade-in-fast 0.2s ease-out forwards; }
        .grid-cols-auto-fit-100 { grid-template-columns: repeat(auto-fit, minmax(60px, 1fr)); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;

        // --- DATA: La banque de questions ---
        const questions = {
            '♥️': { // Cœur : Sex, fantasme, séduction
                '2': ["Quelle est ta plus grande insécurité physique au lit ?", "As-tu déjà eu un crush sur un personnage de fiction ?", "Quel est le compliment le plus sexy que tu aies reçu ?", "Décris ton premier baiser avec la langue.", "Quel est le film qui t'excite le plus ?", "As-tu déjà envoyé un nude par erreur ?", "Quel est ton plus grand 'turn-on' (ce qui t'allume) ?", "Et ton plus grand 'turn-off' (ce qui te refroidit) ?", "As-tu déjà eu un rêve érotique avec quelqu'un de présent à cette table ?", "Quel est le pire conseil en séduction que tu aies reçu ?"],
                '3': ["Raconte la pire expérience sexuelle de ta vie.", "Quel est l'endroit le plus insolite où tu as fait l'amour ?", "As-tu déjà utilisé une application de rencontre ? Laquelle et pourquoi ?", "Décris le baiser le plus mémorable de ta vie.", "Quelle est la chose la plus audacieuse que tu aies faite pour séduire quelqu'un ?", "As-tu déjà eu une relation purement sexuelle (sex-friend) ?", "Quel est le fantasme que tu as honte d'avoir ?", "As-tu déjà simulé un orgasme ? Dans quel contexte ?", "Quelle est la partie du corps que tu préfères chez un partenaire ?", "As-tu déjà eu un rapport sexuel le premier soir ?"],
                '4': ["As-tu un 'body count' (nombre de partenaires) ? Es-tu honnête à ce sujet ?", "Quelle est la pire chose qu'on t'ait dite ou faite pendant l'amour ?", "As-tu déjà eu une relation à distance ? Comment gérais-tu le manque ?", "Quel est ton plus grand regret sexuel ?", "As-tu déjà eu une relation avec quelqu'un de beaucoup plus âgé ou plus jeune ?", "Quelle est ta position sexuelle préférée ?", "Raconte une fois où tu as été surpris(e) en plein acte.", "As-tu déjà eu des sentiments pour un(e) escort ?", "Quel est le plus grand tabou sexuel que tu as brisé ?", "As-tu déjà eu une expérience sexuelle à plusieurs ?"],
                '5': ["Autour de cette table, avec qui aurais-tu le plus de chances d'avoir une aventure d'un soir ?", "As-tu déjà été infidèle ? Raconte sans donner de nom.", "Quel est le fantasme le plus étrange que tu aies réalisé ?", "As-tu déjà eu une relation sexuelle avec quelqu'un que tu venais de rencontrer dans un bar ?", "Quelle est la chose la plus perverse que tu aimes ?", "As-tu déjà eu une relation sexuelle avec deux personnes différentes dans la même journée ?", "Raconte une fois où un rapport sexuel a été interrompu de manière embarrassante.", "As-tu déjà eu une relation avec un(e) collègue de travail ?", "Quel est le secret sexuel le plus sombre que tu n'aies jamais avoué ?", "As-tu déjà payé ou été payé(e) pour un acte sexuel ?"],
                '6': ["Quel est le fétichisme le plus bizarre que tu aies ?", "As-tu déjà eu une relation sexuelle avec le/la partenaire d'un(e) ami(e) ?", "Raconte une expérience impliquant des sex-toys.", "As-tu déjà participé à une orgie ?", "Quelle est la chose la plus dangereuse ou risquée que tu aies faite sexuellement ?", "As-tu déjà eu une relation avec un membre de la famille de ton/ta partenaire ?", "Quel est l'acte sexuel que tu ne feras jamais, même pour un million d'euros ?", "As-tu déjà eu une expérience BDSM (Bondage, Discipline, Sado-Masochisme) ?", "Raconte une expérience sexuelle sous l'emprise de drogues.", "Quel est ton plus grand secret sexuel inavouable ?"]
            },
            '♦️': { // Social : Amour (non sexuel), amis, travail, famille
                '2': ["Quelle est la chose la plus embarrassante que tes parents aient faite devant tes amis ?", "Décris ta plus grande dispute avec un frère ou une sœur.", "Quel est le pire cadeau que tu aies reçu ?", "Raconte ta pire gaffe lors d'un entretien d'embauche.", "Qui était ton meilleur ami d'enfance et pourquoi ne l'es-tu plus ?", "Quelle est la chose la plus gentille qu'un inconnu ait faite pour toi ?", "As-tu déjà été viré(e) d'un travail ?", "Quel est le meilleur conseil que tes parents t'aient donné ?", "Raconte une fois où tu as ressenti une jalousie intense envers un(e) ami(e).", "Quel est le plus grand malentendu te concernant ?"],
                '3': ["Quelle est la chose la plus folle que tu aies faite par amitié ?", "As-tu déjà eu le cœur brisé ? Raconte.", "Quel est le plus grand sacrifice que tu aies fait pour ta famille ?", "Raconte une fois où tu as déçu quelqu'un qui comptait sur toi.", "Qui est la personne dans ta vie qui te connaît le mieux ?", "As-tu déjà mis fin à une amitié importante ? Pourquoi ?", "Quelle est la chose que tes collègues ignorent sur toi ?", "As-tu déjà eu un coup de foudre platonique ?", "Quelle est la tradition familiale la plus étrange que vous ayez ?", "Raconte une fois où tu as défendu un(e) ami(e) bec et ongles."],
                '4': ["Quelle est la chose que tu caches à ta famille ?", "As-tu déjà eu des sentiments amoureux pour un(e) ami(e) proche ?", "Quelle est la plus grande dispute que tu aies eue avec ton/ta meilleur(e) ami(e) ?", "Raconte une fois où tu t'es senti(e) trahi(e) par un collègue.", "Quel est le plus grand regret concernant une amitié passée ?", "As-tu déjà eu une relation toxique (amicale ou familiale) ?", "Quelle est la chose que tu admires le plus chez tes parents ?", "Raconte une fois où tu as pleuré de joie pour quelqu'un d'autre.", "Quel est le plus grand désaccord que tu aies avec tes amis sur un sujet important ?", "As-tu déjà eu à choisir entre deux amis ?"],
                '5': ["Quelle est la plus grande trahison que tu aies vécue de la part d'un proche (ami/famille) ?", "As-tu déjà envisagé de couper les ponts avec un membre de ta famille ? Pourquoi ?", "Raconte une fois où tu as dû mentir pour protéger quelqu'un que tu aimes.", "Quelle est la chose que tu ne pardonneras jamais à un(e) ami(e) ?", "As-tu déjà été amoureux/se de quelqu'un qui ne t'aimait pas en retour ?", "Quel est le plus grand secret de famille que tu connaisses ?", "Raconte une fois où tu as été déçu(e) par ton 'héros' ou modèle.", "As-tu déjà saboté une amitié par jalousie ?", "Quelle est la conversation la plus difficile que tu aies eue avec tes parents ?", "Parmi les personnes à table, qui choisirais-tu pour t'aider à cacher un corps ?"],
                '6': ["As-tu déjà révélé un secret confié par ton/ta meilleur(e) ami(e) ?", "Raconte une fois où tu as délibérément blessé quelqu'un que tu aimes.", "Quelle est la relation (amicale ou familiale) la plus compliquée que tu aies ?", "As-tu déjà utilisé des informations confidentielles du travail à ton avantage ?", "Quel est le plus grand reproche que tu ferais à ta famille ?", "As-tu déjà souhaité secrètement l'échec d'un(e) ami(e) ?", "Raconte une fois où tu as dû choisir entre ta carrière et une relation.", "Quelle est la chose la plus égoïste que tu aies faite qui a impacté tes proches ?", "As-tu déjà eu une relation où tu savais que tu faisais du mal à l'autre personne ?", "Quelle est la vérité la plus dure que tu aies dite à un(e) ami(e) ?"]
            },
            '♠️': { // Karma : Actions immorales, coups de pute, pensées réprouvées
                '2': ["As-tu déjà lu le journal intime ou les messages de quelqu'un ?", "Raconte un mensonge que tu as dit récemment.", "As-tu déjà fait semblant d'aimer un cadeau pour ne pas vexer ?", "As-tu déjà gardé la monnaie rendue en trop ?", "Quelle est la pire rumeur que tu aies propagée ?", "As-tu déjà blâmé quelqu'un d'autre pour une de tes erreurs ?", "As-tu déjà triché à un jeu ?", "Raconte une fois où tu as été incroyablement hypocrite.", "As-tu déjà fait un faux compliment ?", "As-tu déjà profité de la gentillesse de quelqu'un ?"],
                '3': ["Raconte une fois où tu as manipulé quelqu'un pour obtenir ce que tu voulais.", "T'es-tu déjà attribué le mérite du travail d'un autre ?", "As-tu déjà délibérément rendu quelqu'un jaloux ?", "Quelle est la chose la plus méchante que tu aies faite par jalousie ?", "As-tu déjà utilisé un secret contre quelqu'un ?", "Raconte une fois où tu as agi contre tes propres principes par intérêt.", "As-tu déjà fait une promesse en sachant que tu ne la tiendrais pas ?", "As-tu déjà 'oublié' de rendre quelque chose d'important ?", "Quelle est la pensée la plus politiquement incorrecte que tu aies régulièrement ?", "As-tu déjà espionné tes voisins ?"],
                '4': ["Quelle est la chose la plus immorale que tu aies faite pour de l'argent ?", "As-tu déjà délibérément saboté la relation (amicale/amoureuse) de quelqu'un ?", "Raconte une fois où ta lâcheté a eu de graves conséquences pour une autre personne.", "As-tu déjà profité de quelqu'un en état de faiblesse (tristesse, ivresse...) ?", "Quelle est la critique la plus cruelle que tu aies faite sur quelqu'un dans son dos ?", "As-tu déjà abandonné un ami dans le besoin ?", "Quel est le pire conseil que tu aies délibérément donné ?", "As-tu déjà souhaité la mort de quelqu'un ?", "Raconte une fois où tu as été témoin d'une injustice et que tu n'as rien fait.", "Quelle est la chose la plus sournoise que tu aies faite pour obtenir une promotion ou un avantage ?"],
                '5': ["Quelle est la pire chose que tu aies faite et que personne ne saura jamais ?", "Si tu pouvais ruiner la vie d'une personne sans conséquence, le ferais-tu ? Qui ?", "As-tu déjà trahi la confiance de la personne qui t'en accordait le plus ?", "Raconte une fois où tu as fait du mal à quelqu'un juste pour le plaisir de le faire.", "Quelle est la pensée la plus sombre et inavouable que tu aies eue ?", "As-tu déjà fait chanter quelqu'un, même de manière subtile ?", "Quelle est la chose que tu as faite qui te fait le plus honte moralement ?", "As-tu déjà été violent(e) psychologiquement avec un partenaire ?", "Si tu pouvais revenir en arrière, quelle est la seule mauvaise action que tu effacerais ?", "Quelle est la chose la plus cruelle que tu aies faite par vengeance ?"]
            },
            '♣️': { // Punk : Actes illégaux ou de rébellion
                '2': ["As-tu déjà fraudé dans les transports en commun ?", "Quelle est la chose la plus stupide que tu aies faite en étant ivre ?", "As-tu déjà triché à un examen important ?", "Raconte une fois où tu as insulté un professeur ou un supérieur hiérarchique.", "As-tu déjà téléchargé illégalement des films ou de la musique ?", "Quelle est la règle sociale que tu adores transgresser ?", "As-tu déjà participé à une manifestation ?", "As-tu déjà menti à un policier pour une petite infraction ?", "Quel est le plus petit objet que tu aies volé ?", "As-tu déjà fait un doigt d'honneur à une caméra de surveillance ?"],
                '3': ["As-tu déjà volé dans un magasin ? Raconte.", "Quelle est la drogue la plus 'douce' que tu aies testée ?", "As-tu déjà eu une altercation physique (bagarre) ?", "Quel est l'acte de vandalisme le plus simple que tu aies commis (tag, etc.) ?", "As-tu déjà conduit sans permis ou sans assurance ?", "Raconte une fois où tu as fui une situation pour ne pas en assumer les conséquences.", "As-tu déjà menti sur un document officiel (CV, etc.) ?", "Quelle est la chose la plus rebelle que tu aies faite à l'adolescence ?", "As-tu déjà eu des ennuis avec la police ?", "As-tu déjà passé une nuit en cellule de dégrisement ?"],
                '4': ["As-tu déjà pris le volant en état d'ivresse ou sous stupéfiants ?", "Quelle est la drogue la plus 'dure' que tu aies consommée ?", "Quel est l'objet le plus cher que tu aies volé ?", "Raconte une fois où tu as failli te faire arrêter.", "As-tu déjà commis une fraude (assurance, aides sociales...) ?", "Quel est l'acte de rébellion contre l'autorité (police, gouvernement) dont tu es le/la plus fier(e) ?", "As-tu déjà participé à une activité illégale en groupe ?", "As-tu déjà possédé une arme illégalement ?", "Raconte une fois où tu as désobéi à un ordre direct qui a eu de grosses conséquences.", "As-tu déjà aidé quelqu'un à commettre un délit ?"],
                '5': ["Quel est l'acte illégal le plus grave que tu aies commis sans jamais te faire prendre ?", "As-tu déjà fait quelque chose qui aurait pu t'envoyer en prison pour de bon ?", "As-tu déjà été impliqué(e) dans une bagarre qui a très mal tourné ?", "As-tu déjà volé une somme d'argent importante ?", "Raconte une expérience avec le crime organisé, même de loin.", "As-tu déjà commis un délit de fuite après un accident ?", "Quelle est la chose la plus dangereuse que tu aies transportée pour quelqu'un ?", "As-tu déjà pensé à un crime parfait ? Lequel ?", "As-tu déjà été complice d'un crime grave ?", "Si tu devais enfreindre une loi maintenant, sans te faire prendre, laquelle choisirais-tu et pourquoi ?"]
            }
        };
        const THEME_DETAILS = {
            '♥️': { name: 'Cœur', color: 'text-red-500', description: 'Sex, fantasmes, séduction. Tout ce qui touche à l\'intimité charnelle et au désir.' },
            '♦️': { name: 'Social', color: 'text-red-500', description: 'Liens non-sexuels. Amour, amitié, famille, travail. Les dynamiques qui nous lient aux autres.' },
            '♠️': { name: 'Karma', color: 'text-gray-800', description: 'Actions immorales. Coups bas, pensées inavouables, dilemmes moraux. Ce qui n\'est pas illégal, mais discutable.' },
            '♣️': { name: 'Punk', color: 'text-gray-800', description: 'Actes illégaux ou de rébellion. Tout ce qui enfreint la loi ou défie ouvertement l\'autorité.' }
        };

        const generateDeck = () => {
            const deck = [];
            for (const suit in questions) {
                for (const value in questions[suit]) {
                    deck.push({ suit, value });
                }
            }
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            return deck;
        };

        const Card = ({ suit, value, small = false }) => {
            const color = THEME_DETAILS[suit].color;
            const sizeClasses = small ? 'w-20 h-28 sm:w-24 sm:h-36' : 'w-40 h-60 sm:w-48 sm:h-72';
            const valueSize = small ? 'text-xl' : 'text-3xl';
            const suitCenterSize = small ? 'text-4xl' : 'text-6xl';
            return (
                <div className={`${sizeClasses} bg-white rounded-xl shadow-2xl flex flex-col justify-between p-2 sm:p-3 transform transition-transform duration-500 hover:scale-105 relative flex-shrink-0`}>
                    <div className={`${valueSize} font-bold ${color}`}>{value} {suit}</div>
                    <div className={`${suitCenterSize} text-center font-bold ${color} absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2`}>{suit}</div>
                    <div className={`${valueSize} font-bold ${color} self-end transform rotate-180`}>{value} {suit}</div>
                </div>
            );
        };

        const ThemeDisplay = ({ suit, onClick }) => {
            const theme = THEME_DETAILS[suit];
            return (
                <button onClick={onClick} className="flex items-center gap-2 bg-gray-700 px-4 py-2 rounded-full hover:bg-gray-600 transition-colors">
                    <span className={`text-2xl ${theme.color}`}>{suit}</span>
                    <span className="text-white font-bold text-lg">{theme.name}</span>
                </button>
            );
        };

        const QuestionDisplay = ({ historyItem, onNext, onCycleQuestion, isLastCard, onThemeClick }) => {
            if (!historyItem) return null;
            const { card, question } = historyItem;
            return (
                <div className="w-full max-w-lg mx-auto p-6 bg-gray-800 rounded-2xl shadow-2xl flex flex-col items-center gap-4 animate-fade-in">
                    <ThemeDisplay suit={card.suit} onClick={onThemeClick} />
                    <Card suit={card.suit} value={card.value} />
                    <p className="text-white text-xl sm:text-2xl text-center font-light leading-relaxed min-h-[6rem] flex items-center">{question}</p>
                    <div className="w-full flex flex-col gap-3 mt-2">
                        <button onClick={onCycleQuestion} className="w-full bg-gray-600 hover:bg-gray-500 text-white font-bold py-3 px-4 rounded-xl">Changer de question</button>
                        <button onClick={onNext} className="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 px-4 rounded-xl">{isLastCard ? "Terminer la partie" : "Piocher la carte suivante"}</button>
                    </div>
                </div>
            );
        };

        const PhysicalMode = ({ onCardSelect }) => {
            const [suit, setSuit] = useState(null);
            const [value, setValue] = useState(null);
            const handleSelect = () => { if (suit && value) { onCardSelect({ suit, value }); setSuit(null); setValue(null); } };
            return (
                <div className="w-full max-w-lg mx-auto p-6 bg-gray-800 rounded-2xl shadow-2xl flex flex-col items-center gap-6 animate-fade-in">
                    <h2 className="text-2xl font-bold text-white text-center">Sélectionnez la carte piochée</h2>
                    <div className="w-full"><p className="text-lg font-semibold text-gray-300 mb-2">Couleur :</p><div className="grid grid-cols-4 gap-3">{Object.keys(THEME_DETAILS).map(s => (<button key={s} onClick={() => setSuit(s)} className={`py-4 text-3xl rounded-lg transition-all duration-200 ${suit === s ? 'bg-indigo-600 text-white scale-110 shadow-lg' : 'bg-gray-700 text-white hover:bg-gray-600'}`}>{s}</button>))}</div></div>
                    <div className="w-full"><p className="text-lg font-semibold text-gray-300 mb-2">Valeur :</p><div className="grid grid-cols-auto-fit-100 gap-3">{Object.keys(questions[suit] || {}).map(v => (<button key={v} onClick={() => setValue(v)} className={`py-3 text-xl rounded-lg transition-all duration-200 ${value === v ? 'bg-indigo-600 text-white scale-110 shadow-lg' : 'bg-gray-700 text-white hover:bg-gray-600'}`}>{v}</button>))}</div></div>
                    <button onClick={handleSelect} disabled={!suit || !value} className="w-full mt-4 bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-4 rounded-xl disabled:bg-gray-500 disabled:cursor-not-allowed">Voir la question</button>
                </div>
            );
        };

        const QuickPlayMode = ({ onThemeClick, onNewQuestion }) => {
            const [currentQuestion, setCurrentQuestion] = useState({ question: '', suit: null });

            const getNewQuestion = useCallback((suit) => {
                let selectedSuit = suit;
                if (suit === 'random') {
                    const suits = Object.keys(THEME_DETAILS);
                    selectedSuit = suits[Math.floor(Math.random() * suits.length)];
                }
                
                const themeValues = Object.keys(questions[selectedSuit]);
                const randomValue = themeValues[Math.floor(Math.random() * themeValues.length)];
                const questionPool = questions[selectedSuit][randomValue];
                const randomQuestion = questionPool[Math.floor(Math.random() * questionPool.length)];
                
                setCurrentQuestion({ question: randomQuestion, suit: selectedSuit });
                onNewQuestion(randomQuestion, selectedSuit);
            }, [onNewQuestion]);

            useEffect(() => {
                getNewQuestion('random');
            }, []); // Changed dependency to empty array to run only once on mount

            return (
                <div className="w-full max-w-2xl mx-auto p-4 flex flex-col items-center gap-4 animate-fade-in">
                    <h2 className="text-2xl font-bold text-white text-center">Partie Rapide</h2>
                    <div className="w-full grid grid-cols-2 sm:grid-cols-4 gap-4">
                        {Object.entries(THEME_DETAILS).map(([suit, details]) => (
                            <button key={suit} onClick={() => getNewQuestion(suit)} className="bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-2 rounded-xl flex flex-col items-center justify-center gap-1">
                                <span className={`text-4xl ${details.color}`}>{suit}</span>
                                <span className="text-base">{details.name}</span>
                            </button>
                        ))}
                    </div>
                    <div className="w-full mt-2 flex justify-center">
                         <button onClick={() => getNewQuestion('random')} className="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 px-2 rounded-xl flex flex-col items-center justify-center gap-1 w-full sm:w-1/2">
                            <span className="text-4xl">🎲</span>
                            <span className="text-base">Aléatoire</span>
                        </button>
                    </div>
                    {currentQuestion.suit && (
                        <div className="w-full mt-6 flex flex-col items-center gap-4">
                            <ThemeDisplay suit={currentQuestion.suit} onClick={onThemeClick} />
                            <div className="w-full bg-gray-800 rounded-lg p-8 flex justify-center items-center min-h-[12rem] shadow-2xl">
                                <p className="text-white text-2xl text-center font-light leading-relaxed">{currentQuestion.question}</p>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const Menu = ({ onSelectMode, onShowRules }) => (
            <div className="w-full max-w-sm mx-auto p-6 flex flex-col items-center gap-6 animate-fade-in">
                <header className="text-center"><h1 className="text-6xl font-black text-white tracking-tighter">Briz</h1><p className="text-indigo-300 mt-2 text-lg">Le jeu pour brizer la glace.</p></header>
                <div className="w-full flex flex-col gap-4 mt-8">
                    <button onClick={() => onSelectMode('physical')} className="w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-4 px-4 rounded-xl text-left flex items-center gap-4"><span className="text-4xl">🃏</span><div><p className="text-lg">J'ai un jeu de cartes</p><p className="text-sm font-light text-gray-300">Utilisez vos propres cartes.</p></div></button>
                    <button onClick={() => onSelectMode('virtual')} className="w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-4 px-4 rounded-xl text-left flex items-center gap-4"><span className="text-4xl">📱</span><div><p className="text-lg">Tirage de cartes</p><p className="text-sm font-light text-gray-300">Laissez l'app gérer le tirage.</p></div></button>
                    <button onClick={() => onSelectMode('quickplay')} className="w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-4 px-4 rounded-xl text-left flex items-center gap-4"><span className="text-4xl">⚡️</span><div><p className="text-lg">Partie Rapide</p><p className="text-sm font-light text-gray-300">Une question, sans attendre.</p></div></button>
                </div>
                <button onClick={onShowRules} className="text-indigo-300 hover:text-indigo-200 mt-8">Règles du jeu</button>
            </div>
        );

        const History = ({ history, onClose }) => (
            <div className="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50 animate-fade-in-fast" onClick={onClose}>
                <div className="bg-gray-800 rounded-2xl shadow-2xl w-full max-w-2xl h-[80vh] flex flex-col p-6" onClick={e => e.stopPropagation()}>
                    <div className="flex justify-between items-center mb-4"><h2 className="text-2xl font-bold text-white">Historique des questions</h2><button onClick={onClose} className="text-gray-400 hover:text-white text-2xl">&times;</button></div>
                    <div className="overflow-y-auto pr-2">{history.length === 0 ? (<p className="text-gray-400 text-center mt-8">Aucune question pour le moment.</p>) : (<ul className="space-y-4">{history.map((item, index) => (<li key={index} className="bg-gray-700 p-4 rounded-lg flex items-start gap-4"><Card suit={item.card.suit} value={item.card.value} small={true} /><p className="text-white text-lg flex-1">{item.question}</p></li>))}</ul>)}</div>
                </div>
            </div>
        );

        const ConfirmationModal = ({ onConfirm, onCancel }) => (
            <div className="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50 animate-fade-in-fast">
                <div className="bg-gray-800 rounded-2xl shadow-2xl w-full max-w-sm p-8 text-center" onClick={e => e.stopPropagation()}>
                    <h2 className="text-2xl font-bold text-white mb-4">Quitter la partie ?</h2>
                    <p className="text-gray-300 mb-8">Votre progression sera effacée. Êtes-vous sûr ?</p>
                    <div className="flex justify-center gap-4"><button onClick={onCancel} className="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-lg">Annuler</button><button onClick={onConfirm} className="bg-red-600 hover:bg-red-500 text-white font-bold py-2 px-6 rounded-lg">Confirmer</button></div>
                </div>
            </div>
        );

        const EndGameScreen = ({ onRestart }) => (
            <div className="w-full max-w-lg mx-auto p-8 bg-gray-800 rounded-2xl shadow-2xl flex flex-col items-center gap-6 animate-fade-in text-center">
                <h2 className="text-4xl font-bold text-white">Partie terminée !</h2>
                <p className="text-gray-300 text-lg">Vous avez répondu à toutes les questions. J'espère que vous en avez appris plus les uns sur les autres !</p>
                <button onClick={onRestart} className="w-full mt-4 bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-4 rounded-xl">Faire une nouvelle partie</button>
            </div>
        );

        const ThemeModal = ({ onClose }) => (
            <div className="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50 animate-fade-in-fast" onClick={onClose}>
                <div className="bg-gray-800 rounded-2xl shadow-2xl w-full max-w-2xl p-6 m-4" onClick={e => e.stopPropagation()}>
                    <div className="flex justify-between items-center mb-6"><h2 className="text-3xl font-bold text-white">Les Thèmes de Briz</h2><button onClick={onClose} className="text-gray-400 hover:text-white text-3xl">&times;</button></div>
                    <div className="space-y-4">{Object.entries(THEME_DETAILS).map(([suit, details]) => (<div key={suit} className="bg-gray-700 p-4 rounded-lg"><h3 className="text-2xl font-bold flex items-center gap-3"><span className={details.color}>{suit}</span><span className="text-white">{details.name}</span></h3><p className="text-gray-300 mt-1 ml-10">{details.description}</p></div>))}</div>
                </div>
            </div>
        );

        function App() {
            const [mode, setMode] = useState('menu');
            const [deck, setDeck] = useState([]);
            const [history, setHistory] = useState([]);
            const [isGameFinished, setGameFinished] = useState(false);
            const [showHistory, setShowHistory] = useState(false);
            const [showResetModal, setShowResetModal] = useState(false);
            const [showThemeModal, setShowThemeModal] = useState(false);
            const [currentCard, setCurrentCard] = useState(null);

            useEffect(() => {
                try {
                    const savedState = JSON.parse(localStorage.getItem('brizGameState_v8'));
                    if (savedState) {
                        setMode(savedState.mode || 'menu');
                        setDeck(savedState.deck && savedState.deck.length > 0 ? savedState.deck : generateDeck());
                        setHistory(savedState.history || []);
                        setGameFinished(savedState.isGameFinished || false);
                        setCurrentCard(savedState.currentCard || null);
                    } else {
                        setDeck(generateDeck());
                    }
                } catch (error) {
                    console.error("Failed to load state", error);
                    setDeck(generateDeck());
                }
            }, []);

            useEffect(() => {
                const gameState = { mode, deck, history, isGameFinished, currentCard };
                localStorage.setItem('brizGameState_v8', JSON.stringify(gameState));
            }, [mode, deck, history, isGameFinished, currentCard]);

            const resetGame = () => {
                localStorage.removeItem('brizGameState_v8');
                setMode('menu');
                setDeck(generateDeck());
                setHistory([]);
                setGameFinished(false);
                setCurrentCard(null);
                setShowResetModal(false);
            };

            const drawVirtualCard = useCallback(() => {
                if (deck.length > 0) {
                    const card = deck[0];
                    const question = questions[card.suit][card.value][0];
                    setHistory(prev => [{ card, question, qIndex: 0 }, ...prev]);
                    setDeck(d => d.slice(1));
                }
            }, [deck]);

            useEffect(() => {
                if (mode === 'virtual' && history.length === 0 && !isGameFinished && deck.length > 0) {
                    drawVirtualCard();
                }
            }, [mode, history.length, isGameFinished, drawVirtualCard, deck.length]);

            const handlePhysicalCardSelection = (card) => {
                const question = questions[card.suit][card.value][0];
                const newItem = { card, question, qIndex: 0 };
                setCurrentCard(newItem);
                setHistory(prev => [newItem, ...prev]);
            };
            
            const addQuickPlayQuestionToHistory = useCallback((question, suit) => {
                const newItem = {
                    card: { suit, value: '⚡️' },
                    question,
                    qIndex: 0
                };
                setHistory(prev => [newItem, ...prev]);
            }, []);

            const cycleQuestion = () => {
                const activeItem = mode === 'physical' ? currentCard : history[0];
                if (!activeItem || activeItem.card.value === '⚡️') return;

                const { card, qIndex } = activeItem;
                const questionPool = questions[card.suit][card.value];
                const newQIndex = (qIndex + 1) % questionPool.length;
                const newQuestion = questionPool[newQIndex];
                
                const newItem = { card, question: newQuestion, qIndex: newQIndex };

                if (mode === 'physical') {
                    setCurrentCard(newItem);
                    setHistory(prev => [newItem, ...prev.slice(1)]);
                } else {
                    setHistory(prev => [newItem, ...prev.slice(1)]);
                }
            };
            
            const handleNextQuestion = () => {
                if (mode === 'virtual') {
                    if (deck.length === 0) {
                        setGameFinished(true);
                    } else {
                        drawVirtualCard();
                    }
                } else {
                    setCurrentCard(null);
                }
            };

            const renderContent = () => {
                if (isGameFinished) return <EndGameScreen onRestart={resetGame} />;

                const activeItem = mode === 'physical' ? currentCard : history[0];

                if ((mode === 'virtual' || mode === 'physical') && activeItem) {
                    return <QuestionDisplay historyItem={activeItem} onNext={handleNextQuestion} onCycleQuestion={cycleQuestion} isLastCard={deck.length === 0 && mode === 'virtual'} onThemeClick={() => setShowThemeModal(true)} />;
                }
                
                switch (mode) {
                    case 'physical': return <PhysicalMode onCardSelect={handlePhysicalCardSelection} />;
                    case 'quickplay': return <QuickPlayMode onThemeClick={() => setShowThemeModal(true)} onNewQuestion={addQuickPlayQuestionToHistory} />;
                    case 'menu': default: return <Menu onSelectMode={setMode} onShowRules={() => setShowThemeModal(true)} />;
                }
            };

            return (
                <main className="bg-gray-900 min-h-screen w-full flex flex-col items-center justify-center p-4 font-sans relative">
                    <div className="absolute top-4 w-full flex justify-between items-center px-4 max-w-4xl mx-auto">
                        {mode !== 'menu' && !isGameFinished ? (<button onClick={() => setShowResetModal(true)} className="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-full shadow-lg z-10">&larr; Menu</button>) : <div/>}
                        {mode === 'virtual' && !isGameFinished && (<div className="text-gray-300 text-lg font-semibold bg-gray-700 px-4 py-2 rounded-full z-10">Cartes : {deck.length}</div>)}
                        {mode !== 'menu' && history.length > 0 && !isGameFinished ? (<button onClick={() => setShowHistory(true)} className="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-full shadow-lg z-10">Historique</button>) : <div/>}
                    </div>
                    
                    {showHistory && <History history={history} onClose={() => setShowHistory(false)} />}
                    {showResetModal && <ConfirmationModal onConfirm={resetGame} onCancel={() => setShowResetModal(false)} />}
                    {showThemeModal && <ThemeModal onClose={() => setShowThemeModal(false)} />}
                    
                    <div className="w-full flex-grow flex items-center justify-center">{renderContent()}</div>
                    <footer className="w-full text-center text-gray-600 text-sm py-4">Fait avec ♥️ pour des soirées mémorables.</footer>
                </main>
            );
        }

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
