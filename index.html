<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Briz - Le jeu pour brizer la glace</title>
    <meta name="description" content="Briz - Le jeu pour brizer la glace.">
    <meta name="theme-color" content="#111827" />
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel to transpile JSX in the browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;700;900&display=swap');
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #111827;
        }
        @keyframes fade-in { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fade-in-fast { from { opacity: 0; } to { opacity: 1; } }
        .animate-fade-in { animation: fade-in 0.5s ease-out forwards; }
        .animate-fade-in-fast { animation: fade-in-fast 0.2s ease-out forwards; }
        .grid-cols-auto-fit-100 { grid-template-columns: repeat(auto-fit, minmax(60px, 1fr)); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback } = React;

        // --- DATA: La banque de questions ---
        const questions = {
            '‚ô•Ô∏è': { // C≈ìur : Sex, fantasme, s√©duction
                '2': ["Quelle est ta plus grande ins√©curit√© physique au lit ?", "As-tu d√©j√† eu un crush sur un personnage de fiction ?", "Quel est le compliment le plus sexy que tu aies re√ßu ?", "D√©cris ton premier baiser avec la langue.", "Quel est le film qui t'excite le plus ?", "As-tu d√©j√† envoy√© un nude par erreur ?", "Quel est ton plus grand 'turn-on' (ce qui t'allume) ?", "Et ton plus grand 'turn-off' (ce qui te refroidit) ?", "As-tu d√©j√† eu un r√™ve √©rotique avec quelqu'un de pr√©sent √† cette table ?", "Quel est le pire conseil en s√©duction que tu aies re√ßu ?"],
                '3': ["Raconte la pire exp√©rience sexuelle de ta vie.", "Quel est l'endroit le plus insolite o√π tu as fait l'amour ?", "As-tu d√©j√† utilis√© une application de rencontre ? Laquelle et pourquoi ?", "D√©cris le baiser le plus m√©morable de ta vie.", "Quelle est la chose la plus audacieuse que tu aies faite pour s√©duire quelqu'un ?", "As-tu d√©j√† eu une relation purement sexuelle (sex-friend) ?", "Quel est le fantasme que tu as honte d'avoir ?", "As-tu d√©j√† simul√© un orgasme ? Dans quel contexte ?", "Quelle est la partie du corps que tu pr√©f√®res chez un partenaire ?", "As-tu d√©j√† eu un rapport sexuel le premier soir ?"],
                '4': ["As-tu un 'body count' (nombre de partenaires) ? Es-tu honn√™te √† ce sujet ?", "Quelle est la pire chose qu'on t'ait dite ou faite pendant l'amour ?", "As-tu d√©j√† eu une relation √† distance ? Comment g√©rais-tu le manque ?", "Quel est ton plus grand regret sexuel ?", "As-tu d√©j√† eu une relation avec quelqu'un de beaucoup plus √¢g√© ou plus jeune ?", "Quelle est ta position sexuelle pr√©f√©r√©e ?", "Raconte une fois o√π tu as √©t√© surpris(e) en plein acte.", "As-tu d√©j√† eu des sentiments pour un(e) escort ?", "Quel est le plus grand tabou sexuel que tu as bris√© ?", "As-tu d√©j√† eu une exp√©rience sexuelle √† plusieurs ?"],
                '5': ["Autour de cette table, avec qui aurais-tu le plus de chances d'avoir une aventure d'un soir ?", "As-tu d√©j√† √©t√© infid√®le ? Raconte sans donner de nom.", "Quel est le fantasme le plus √©trange que tu aies r√©alis√© ?", "As-tu d√©j√† eu une relation sexuelle avec quelqu'un que tu venais de rencontrer dans un bar ?", "Quelle est la chose la plus perverse que tu aimes ?", "As-tu d√©j√† eu une relation sexuelle avec deux personnes diff√©rentes dans la m√™me journ√©e ?", "Raconte une fois o√π un rapport sexuel a √©t√© interrompu de mani√®re embarrassante.", "As-tu d√©j√† eu une relation avec un(e) coll√®gue de travail ?", "Quel est le secret sexuel le plus sombre que tu n'aies jamais avou√© ?", "As-tu d√©j√† pay√© ou √©t√© pay√©(e) pour un acte sexuel ?"],
                '6': ["Quel est le f√©tichisme le plus bizarre que tu aies ?", "As-tu d√©j√† eu une relation sexuelle avec le/la partenaire d'un(e) ami(e) ?", "Raconte une exp√©rience impliquant des sex-toys.", "As-tu d√©j√† particip√© √† une orgie ?", "Quelle est la chose la plus dangereuse ou risqu√©e que tu aies faite sexuellement ?", "As-tu d√©j√† eu une relation avec un membre de la famille de ton/ta partenaire ?", "Quel est l'acte sexuel que tu ne feras jamais, m√™me pour un million d'euros ?", "As-tu d√©j√† eu une exp√©rience BDSM (Bondage, Discipline, Sado-Masochisme) ?", "Raconte une exp√©rience sexuelle sous l'emprise de drogues.", "Quel est ton plus grand secret sexuel inavouable ?"]
            },
            '‚ô¶Ô∏è': { // Social : Amour (non sexuel), amis, travail, famille
                '2': ["Quelle est la chose la plus embarrassante que tes parents aient faite devant tes amis ?", "D√©cris ta plus grande dispute avec un fr√®re ou une s≈ìur.", "Quel est le pire cadeau que tu aies re√ßu ?", "Raconte ta pire gaffe lors d'un entretien d'embauche.", "Qui √©tait ton meilleur ami d'enfance et pourquoi ne l'es-tu plus ?", "Quelle est la chose la plus gentille qu'un inconnu ait faite pour toi ?", "As-tu d√©j√† √©t√© vir√©(e) d'un travail ?", "Quel est le meilleur conseil que tes parents t'aient donn√© ?", "Raconte une fois o√π tu as ressenti une jalousie intense envers un(e) ami(e).", "Quel est le plus grand malentendu te concernant ?"],
                '3': ["Quelle est la chose la plus folle que tu aies faite par amiti√© ?", "As-tu d√©j√† eu le c≈ìur bris√© ? Raconte.", "Quel est le plus grand sacrifice que tu aies fait pour ta famille ?", "Raconte une fois o√π tu as d√©√ßu quelqu'un qui comptait sur toi.", "Qui est la personne dans ta vie qui te conna√Æt le mieux ?", "As-tu d√©j√† mis fin √† une amiti√© importante ? Pourquoi ?", "Quelle est la chose que tes coll√®gues ignorent sur toi ?", "As-tu d√©j√† eu un coup de foudre platonique ?", "Quelle est la tradition familiale la plus √©trange que vous ayez ?", "Raconte une fois o√π tu as d√©fendu un(e) ami(e) bec et ongles."],
                '4': ["Quelle est la chose que tu caches √† ta famille ?", "As-tu d√©j√† eu des sentiments amoureux pour un(e) ami(e) proche ?", "Quelle est la plus grande dispute que tu aies eue avec ton/ta meilleur(e) ami(e) ?", "Raconte une fois o√π tu t'es senti(e) trahi(e) par un coll√®gue.", "Quel est le plus grand regret concernant une amiti√© pass√©e ?", "As-tu d√©j√† eu une relation toxique (amicale ou familiale) ?", "Quelle est la chose que tu admires le plus chez tes parents ?", "Raconte une fois o√π tu as pleur√© de joie pour quelqu'un d'autre.", "Quel est le plus grand d√©saccord que tu aies avec tes amis sur un sujet important ?", "As-tu d√©j√† eu √† choisir entre deux amis ?"],
                '5': ["Quelle est la plus grande trahison que tu aies v√©cue de la part d'un proche (ami/famille) ?", "As-tu d√©j√† envisag√© de couper les ponts avec un membre de ta famille ? Pourquoi ?", "Raconte une fois o√π tu as d√ª mentir pour prot√©ger quelqu'un que tu aimes.", "Quelle est la chose que tu ne pardonneras jamais √† un(e) ami(e) ?", "As-tu d√©j√† √©t√© amoureux/se de quelqu'un qui ne t'aimait pas en retour ?", "Quel est le plus grand secret de famille que tu connaisses ?", "Raconte une fois o√π tu as √©t√© d√©√ßu(e) par ton 'h√©ros' ou mod√®le.", "As-tu d√©j√† sabot√© une amiti√© par jalousie ?", "Quelle est la conversation la plus difficile que tu aies eue avec tes parents ?", "Parmi les personnes √† table, qui choisirais-tu pour t'aider √† cacher un corps ?"],
                '6': ["As-tu d√©j√† r√©v√©l√© un secret confi√© par ton/ta meilleur(e) ami(e) ?", "Raconte une fois o√π tu as d√©lib√©r√©ment bless√© quelqu'un que tu aimes.", "Quelle est la relation (amicale ou familiale) la plus compliqu√©e que tu aies ?", "As-tu d√©j√† utilis√© des informations confidentielles du travail √† ton avantage ?", "Quel est le plus grand reproche que tu ferais √† ta famille ?", "As-tu d√©j√† souhait√© secr√®tement l'√©chec d'un(e) ami(e) ?", "Raconte une fois o√π tu as d√ª choisir entre ta carri√®re et une relation.", "Quelle est la chose la plus √©go√Øste que tu aies faite qui a impact√© tes proches ?", "As-tu d√©j√† eu une relation o√π tu savais que tu faisais du mal √† l'autre personne ?", "Quelle est la v√©rit√© la plus dure que tu aies dite √† un(e) ami(e) ?"]
            },
            '‚ô†Ô∏è': { // Karma : Actions immorales, coups de pute, pens√©es r√©prouv√©es
                '2': ["As-tu d√©j√† lu le journal intime ou les messages de quelqu'un ?", "Raconte un mensonge que tu as dit r√©cemment.", "As-tu d√©j√† fait semblant d'aimer un cadeau pour ne pas vexer ?", "As-tu d√©j√† gard√© la monnaie rendue en trop ?", "Quelle est la pire rumeur que tu aies propag√©e ?", "As-tu d√©j√† bl√¢m√© quelqu'un d'autre pour une de tes erreurs ?", "As-tu d√©j√† trich√© √† un jeu ?", "Raconte une fois o√π tu as √©t√© incroyablement hypocrite.", "As-tu d√©j√† fait un faux compliment ?", "As-tu d√©j√† profit√© de la gentillesse de quelqu'un ?"],
                '3': ["Raconte une fois o√π tu as manipul√© quelqu'un pour obtenir ce que tu voulais.", "T'es-tu d√©j√† attribu√© le m√©rite du travail d'un autre ?", "As-tu d√©j√† d√©lib√©r√©ment rendu quelqu'un jaloux ?", "Quelle est la chose la plus m√©chante que tu aies faite par jalousie ?", "As-tu d√©j√† utilis√© un secret contre quelqu'un ?", "Raconte une fois o√π tu as agi contre tes propres principes par int√©r√™t.", "As-tu d√©j√† fait une promesse en sachant que tu ne la tiendrais pas ?", "As-tu d√©j√† 'oubli√©' de rendre quelque chose d'important ?", "Quelle est la pens√©e la plus politiquement incorrecte que tu aies r√©guli√®rement ?", "As-tu d√©j√† espionn√© tes voisins ?"],
                '4': ["Quelle est la chose la plus immorale que tu aies faite pour de l'argent ?", "As-tu d√©j√† d√©lib√©r√©ment sabot√© la relation (amicale/amoureuse) de quelqu'un ?", "Raconte une fois o√π ta l√¢chet√© a eu de graves cons√©quences pour une autre personne.", "As-tu d√©j√† profit√© de quelqu'un en √©tat de faiblesse (tristesse, ivresse...) ?", "Quelle est la critique la plus cruelle que tu aies faite sur quelqu'un dans son dos ?", "As-tu d√©j√† abandonn√© un ami dans le besoin ?", "Quel est le pire conseil que tu aies d√©lib√©r√©ment donn√© ?", "As-tu d√©j√† souhait√© la mort de quelqu'un ?", "Raconte une fois o√π tu as √©t√© t√©moin d'une injustice et que tu n'as rien fait.", "Quelle est la chose la plus sournoise que tu aies faite pour obtenir une promotion ou un avantage ?"],
                '5': ["Quelle est la pire chose que tu aies faite et que personne ne saura jamais ?", "Si tu pouvais ruiner la vie d'une personne sans cons√©quence, le ferais-tu ? Qui ?", "As-tu d√©j√† trahi la confiance de la personne qui t'en accordait le plus ?", "Raconte une fois o√π tu as fait du mal √† quelqu'un juste pour le plaisir de le faire.", "Quelle est la pens√©e la plus sombre et inavouable que tu aies eue ?", "As-tu d√©j√† fait chanter quelqu'un, m√™me de mani√®re subtile ?", "Quelle est la chose que tu as faite qui te fait le plus honte moralement ?", "As-tu d√©j√† √©t√© violent(e) psychologiquement avec un partenaire ?", "Si tu pouvais revenir en arri√®re, quelle est la seule mauvaise action que tu effacerais ?", "Quelle est la chose la plus cruelle que tu aies faite par vengeance ?"]
            },
            '‚ô£Ô∏è': { // Punk : Actes ill√©gaux ou de r√©bellion
                '2': ["As-tu d√©j√† fraud√© dans les transports en commun ?", "Quelle est la chose la plus stupide que tu aies faite en √©tant ivre ?", "As-tu d√©j√† trich√© √† un examen important ?", "Raconte une fois o√π tu as insult√© un professeur ou un sup√©rieur hi√©rarchique.", "As-tu d√©j√† t√©l√©charg√© ill√©galement des films ou de la musique ?", "Quelle est la r√®gle sociale que tu adores transgresser ?", "As-tu d√©j√† particip√© √† une manifestation ?", "As-tu d√©j√† menti √† un policier pour une petite infraction ?", "Quel est le plus petit objet que tu aies vol√© ?", "As-tu d√©j√† fait un doigt d'honneur √† une cam√©ra de surveillance ?"],
                '3': ["As-tu d√©j√† vol√© dans un magasin ? Raconte.", "Quelle est la drogue la plus 'douce' que tu aies test√©e ?", "As-tu d√©j√† eu une altercation physique (bagarre) ?", "Quel est l'acte de vandalisme le plus simple que tu aies commis (tag, etc.) ?", "As-tu d√©j√† conduit sans permis ou sans assurance ?", "Raconte une fois o√π tu as fui une situation pour ne pas en assumer les cons√©quences.", "As-tu d√©j√† menti sur un document officiel (CV, etc.) ?", "Quelle est la chose la plus rebelle que tu aies faite √† l'adolescence ?", "As-tu d√©j√† eu des ennuis avec la police ?", "As-tu d√©j√† pass√© une nuit en cellule de d√©grisement ?"],
                '4': ["As-tu d√©j√† pris le volant en √©tat d'ivresse ou sous stup√©fiants ?", "Quelle est la drogue la plus 'dure' que tu aies consomm√©e ?", "Quel est l'objet le plus cher que tu aies vol√© ?", "Raconte une fois o√π tu as failli te faire arr√™ter.", "As-tu d√©j√† commis une fraude (assurance, aides sociales...) ?", "Quel est l'acte de r√©bellion contre l'autorit√© (police, gouvernement) dont tu es le/la plus fier(e) ?", "As-tu d√©j√† particip√© √† une activit√© ill√©gale en groupe ?", "As-tu d√©j√† poss√©d√© une arme ill√©galement ?", "Raconte une fois o√π tu as d√©sob√©i √† un ordre direct qui a eu de grosses cons√©quences.", "As-tu d√©j√† aid√© quelqu'un √† commettre un d√©lit ?"],
                '5': ["Quel est l'acte ill√©gal le plus grave que tu aies commis sans jamais te faire prendre ?", "As-tu d√©j√† fait quelque chose qui aurait pu t'envoyer en prison pour de bon ?", "As-tu d√©j√† √©t√© impliqu√©(e) dans une bagarre qui a tr√®s mal tourn√© ?", "As-tu d√©j√† vol√© une somme d'argent importante ?", "Raconte une exp√©rience avec le crime organis√©, m√™me de loin.", "As-tu d√©j√† commis un d√©lit de fuite apr√®s un accident ?", "Quelle est la chose la plus dangereuse que tu aies transport√©e pour quelqu'un ?", "As-tu d√©j√† pens√© √† un crime parfait ? Lequel ?", "As-tu d√©j√† √©t√© complice d'un crime grave ?", "Si tu devais enfreindre une loi maintenant, sans te faire prendre, laquelle choisirais-tu et pourquoi ?"]
            }
        };
        const THEME_DETAILS = {
            '‚ô•Ô∏è': { name: 'C≈ìur', color: 'text-red-500', description: 'Sex, fantasmes, s√©duction. Tout ce qui touche √† l\'intimit√© charnelle et au d√©sir.' },
            '‚ô¶Ô∏è': { name: 'Social', color: 'text-red-500', description: 'Liens non-sexuels. Amour, amiti√©, famille, travail. Les dynamiques qui nous lient aux autres.' },
            '‚ô†Ô∏è': { name: 'Karma', color: 'text-gray-800', description: 'Actions immorales. Coups bas, pens√©es inavouables, dilemmes moraux. Ce qui n\'est pas ill√©gal, mais discutable.' },
            '‚ô£Ô∏è': { name: 'Punk', color: 'text-gray-800', description: 'Actes ill√©gaux ou de r√©bellion. Tout ce qui enfreint la loi ou d√©fie ouvertement l\'autorit√©.' }
        };

        const generateDeck = () => {
            const deck = [];
            for (const suit in questions) {
                for (const value in questions[suit]) {
                    deck.push({ suit, value });
                }
            }
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            return deck;
        };

        const Card = ({ suit, value, small = false }) => {
            const color = THEME_DETAILS[suit].color;
            const sizeClasses = small ? 'w-20 h-28 sm:w-24 sm:h-36' : 'w-40 h-60 sm:w-48 sm:h-72';
            const valueSize = small ? 'text-xl' : 'text-3xl';
            const suitCenterSize = small ? 'text-4xl' : 'text-6xl';
            return (
                <div className={`${sizeClasses} bg-white rounded-xl shadow-2xl flex flex-col justify-between p-2 sm:p-3 transform transition-transform duration-500 hover:scale-105 relative flex-shrink-0`}>
                    <div className={`${valueSize} font-bold ${color}`}>{value} {suit}</div>
                    <div className={`${suitCenterSize} text-center font-bold ${color} absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2`}>{suit}</div>
                    <div className={`${valueSize} font-bold ${color} self-end transform rotate-180`}>{value} {suit}</div>
                </div>
            );
        };

        const ThemeDisplay = ({ suit, onClick }) => {
            const theme = THEME_DETAILS[suit];
            return (
                <button onClick={onClick} className="flex items-center gap-2 bg-gray-700 px-4 py-2 rounded-full hover:bg-gray-600 transition-colors">
                    <span className={`text-2xl ${theme.color}`}>{suit}</span>
                    <span className="text-white font-bold text-lg">{theme.name}</span>
                </button>
            );
        };

        const QuestionDisplay = ({ historyItem, onNext, onCycleQuestion, isLastCard, onThemeClick }) => {
            if (!historyItem) return null;
            const { card, question } = historyItem;
            return (
                <div className="w-full max-w-lg mx-auto p-6 bg-gray-800 rounded-2xl shadow-2xl flex flex-col items-center gap-4 animate-fade-in">
                    <ThemeDisplay suit={card.suit} onClick={onThemeClick} />
                    <Card suit={card.suit} value={card.value} />
                    <p className="text-white text-xl sm:text-2xl text-center font-light leading-relaxed min-h-[6rem] flex items-center">{question}</p>
                    <div className="w-full flex flex-col gap-3 mt-2">
                        <button onClick={onCycleQuestion} className="w-full bg-gray-600 hover:bg-gray-500 text-white font-bold py-3 px-4 rounded-xl">Changer de question</button>
                        <button onClick={onNext} className="w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 px-4 rounded-xl">{isLastCard ? "Terminer la partie" : "Piocher la carte suivante"}</button>
                    </div>
                </div>
            );
        };

        const PhysicalMode = ({ onCardSelect }) => {
            const [suit, setSuit] = useState(null);
            const [value, setValue] = useState(null);
            const handleSelect = () => { if (suit && value) { onCardSelect({ suit, value }); setSuit(null); setValue(null); } };
            return (
                <div className="w-full max-w-lg mx-auto p-6 bg-gray-800 rounded-2xl shadow-2xl flex flex-col items-center gap-6 animate-fade-in">
                    <h2 className="text-2xl font-bold text-white text-center">S√©lectionnez la carte pioch√©e</h2>
                    <div className="w-full"><p className="text-lg font-semibold text-gray-300 mb-2">Couleur :</p><div className="grid grid-cols-4 gap-3">{Object.keys(THEME_DETAILS).map(s => (<button key={s} onClick={() => setSuit(s)} className={`py-4 text-3xl rounded-lg transition-all duration-200 ${suit === s ? 'bg-indigo-600 text-white scale-110 shadow-lg' : 'bg-gray-700 text-white hover:bg-gray-600'}`}>{s}</button>))}</div></div>
                    <div className="w-full"><p className="text-lg font-semibold text-gray-300 mb-2">Valeur :</p><div className="grid grid-cols-auto-fit-100 gap-3">{Object.keys(questions[suit] || {}).map(v => (<button key={v} onClick={() => setValue(v)} className={`py-3 text-xl rounded-lg transition-all duration-200 ${value === v ? 'bg-indigo-600 text-white scale-110 shadow-lg' : 'bg-gray-700 text-white hover:bg-gray-600'}`}>{v}</button>))}</div></div>
                    <button onClick={handleSelect} disabled={!suit || !value} className="w-full mt-4 bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-4 rounded-xl disabled:bg-gray-500 disabled:cursor-not-allowed">Voir la question</button>
                </div>
            );
        };

        const QuickPlayMode = ({ onThemeClick, onNewQuestion }) => {
            const [currentQuestion, setCurrentQuestion] = useState({ question: '', suit: null });

            const getNewQuestion = useCallback((suit) => {
                let selectedSuit = suit;
                if (suit === 'random') {
                    const suits = Object.keys(THEME_DETAILS);
                    selectedSuit = suits[Math.floor(Math.random() * suits.length)];
                }
                
                const themeValues = Object.keys(questions[selectedSuit]);
                const randomValue = themeValues[Math.floor(Math.random() * themeValues.length)];
                const questionPool = questions[selectedSuit][randomValue];
                const randomQuestion = questionPool[Math.floor(Math.random() * questionPool.length)];
                
                setCurrentQuestion({ question: randomQuestion, suit: selectedSuit });
                onNewQuestion(randomQuestion, selectedSuit);
            }, [onNewQuestion]);

            useEffect(() => {
                getNewQuestion('random');
            }, []); // Changed dependency to empty array to run only once on mount

            return (
                <div className="w-full max-w-2xl mx-auto p-4 flex flex-col items-center gap-4 animate-fade-in">
                    <h2 className="text-2xl font-bold text-white text-center">Partie Rapide</h2>
                    <div className="w-full grid grid-cols-2 sm:grid-cols-4 gap-4">
                        {Object.entries(THEME_DETAILS).map(([suit, details]) => (
                            <button key={suit} onClick={() => getNewQuestion(suit)} className="bg-gray-700 hover:bg-gray-600 text-white font-bold py-3 px-2 rounded-xl flex flex-col items-center justify-center gap-1">
                                <span className={`text-4xl ${details.color}`}>{suit}</span>
                                <span className="text-base">{details.name}</span>
                            </button>
                        ))}
                    </div>
                    <div className="w-full mt-2 flex justify-center">
                         <button onClick={() => getNewQuestion('random')} className="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 px-2 rounded-xl flex flex-col items-center justify-center gap-1 w-full sm:w-1/2">
                            <span className="text-4xl">üé≤</span>
                            <span className="text-base">Al√©atoire</span>
                        </button>
                    </div>
                    {currentQuestion.suit && (
                        <div className="w-full mt-6 flex flex-col items-center gap-4">
                            <ThemeDisplay suit={currentQuestion.suit} onClick={onThemeClick} />
                            <div className="w-full bg-gray-800 rounded-lg p-8 flex justify-center items-center min-h-[12rem] shadow-2xl">
                                <p className="text-white text-2xl text-center font-light leading-relaxed">{currentQuestion.question}</p>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const Menu = ({ onSelectMode, onShowRules }) => (
            <div className="w-full max-w-sm mx-auto p-6 flex flex-col items-center gap-6 animate-fade-in">
                <header className="text-center"><h1 className="text-6xl font-black text-white tracking-tighter">Briz</h1><p className="text-indigo-300 mt-2 text-lg">Le jeu pour brizer la glace.</p></header>
                <div className="w-full flex flex-col gap-4 mt-8">
                    <button onClick={() => onSelectMode('physical')} className="w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-4 px-4 rounded-xl text-left flex items-center gap-4"><span className="text-4xl">üÉè</span><div><p className="text-lg">J'ai un jeu de cartes</p><p className="text-sm font-light text-gray-300">Utilisez vos propres cartes.</p></div></button>
                    <button onClick={() => onSelectMode('virtual')} className="w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-4 px-4 rounded-xl text-left flex items-center gap-4"><span className="text-4xl">üì±</span><div><p className="text-lg">Tirage de cartes</p><p className="text-sm font-light text-gray-300">Laissez l'app g√©rer le tirage.</p></div></button>
                    <button onClick={() => onSelectMode('quickplay')} className="w-full bg-gray-700 hover:bg-gray-600 text-white font-bold py-4 px-4 rounded-xl text-left flex items-center gap-4"><span className="text-4xl">‚ö°Ô∏è</span><div><p className="text-lg">Partie Rapide</p><p className="text-sm font-light text-gray-300">Une question, sans attendre.</p></div></button>
                </div>
                <button onClick={onShowRules} className="text-indigo-300 hover:text-indigo-200 mt-8">R√®gles du jeu</button>
            </div>
        );

        const History = ({ history, onClose }) => (
            <div className="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50 animate-fade-in-fast" onClick={onClose}>
                <div className="bg-gray-800 rounded-2xl shadow-2xl w-full max-w-2xl h-[80vh] flex flex-col p-6" onClick={e => e.stopPropagation()}>
                    <div className="flex justify-between items-center mb-4"><h2 className="text-2xl font-bold text-white">Historique des questions</h2><button onClick={onClose} className="text-gray-400 hover:text-white text-2xl">&times;</button></div>
                    <div className="overflow-y-auto pr-2">{history.length === 0 ? (<p className="text-gray-400 text-center mt-8">Aucune question pour le moment.</p>) : (<ul className="space-y-4">{history.map((item, index) => (<li key={index} className="bg-gray-700 p-4 rounded-lg flex items-start gap-4"><Card suit={item.card.suit} value={item.card.value} small={true} /><p className="text-white text-lg flex-1">{item.question}</p></li>))}</ul>)}</div>
                </div>
            </div>
        );

        const ConfirmationModal = ({ onConfirm, onCancel }) => (
            <div className="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50 animate-fade-in-fast">
                <div className="bg-gray-800 rounded-2xl shadow-2xl w-full max-w-sm p-8 text-center" onClick={e => e.stopPropagation()}>
                    <h2 className="text-2xl font-bold text-white mb-4">Quitter la partie ?</h2>
                    <p className="text-gray-300 mb-8">Votre progression sera effac√©e. √ätes-vous s√ªr ?</p>
                    <div className="flex justify-center gap-4"><button onClick={onCancel} className="bg-gray-600 hover:bg-gray-500 text-white font-bold py-2 px-6 rounded-lg">Annuler</button><button onClick={onConfirm} className="bg-red-600 hover:bg-red-500 text-white font-bold py-2 px-6 rounded-lg">Confirmer</button></div>
                </div>
            </div>
        );

        const EndGameScreen = ({ onRestart }) => (
            <div className="w-full max-w-lg mx-auto p-8 bg-gray-800 rounded-2xl shadow-2xl flex flex-col items-center gap-6 animate-fade-in text-center">
                <h2 className="text-4xl font-bold text-white">Partie termin√©e !</h2>
                <p className="text-gray-300 text-lg">Vous avez r√©pondu √† toutes les questions. J'esp√®re que vous en avez appris plus les uns sur les autres !</p>
                <button onClick={onRestart} className="w-full mt-4 bg-green-600 hover:bg-green-500 text-white font-bold py-3 px-4 rounded-xl">Faire une nouvelle partie</button>
            </div>
        );

        const ThemeModal = ({ onClose }) => (
            <div className="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50 animate-fade-in-fast" onClick={onClose}>
                <div className="bg-gray-800 rounded-2xl shadow-2xl w-full max-w-2xl p-6 m-4" onClick={e => e.stopPropagation()}>
                    <div className="flex justify-between items-center mb-6"><h2 className="text-3xl font-bold text-white">Les Th√®mes de Briz</h2><button onClick={onClose} className="text-gray-400 hover:text-white text-3xl">&times;</button></div>
                    <div className="space-y-4">{Object.entries(THEME_DETAILS).map(([suit, details]) => (<div key={suit} className="bg-gray-700 p-4 rounded-lg"><h3 className="text-2xl font-bold flex items-center gap-3"><span className={details.color}>{suit}</span><span className="text-white">{details.name}</span></h3><p className="text-gray-300 mt-1 ml-10">{details.description}</p></div>))}</div>
                </div>
            </div>
        );

        function App() {
            const [mode, setMode] = useState('menu');
            const [deck, setDeck] = useState([]);
            const [history, setHistory] = useState([]);
            const [isGameFinished, setGameFinished] = useState(false);
            const [showHistory, setShowHistory] = useState(false);
            const [showResetModal, setShowResetModal] = useState(false);
            const [showThemeModal, setShowThemeModal] = useState(false);
            const [currentCard, setCurrentCard] = useState(null);

            useEffect(() => {
                try {
                    const savedState = JSON.parse(localStorage.getItem('brizGameState_v8'));
                    if (savedState) {
                        setMode(savedState.mode || 'menu');
                        setDeck(savedState.deck && savedState.deck.length > 0 ? savedState.deck : generateDeck());
                        setHistory(savedState.history || []);
                        setGameFinished(savedState.isGameFinished || false);
                        setCurrentCard(savedState.currentCard || null);
                    } else {
                        setDeck(generateDeck());
                    }
                } catch (error) {
                    console.error("Failed to load state", error);
                    setDeck(generateDeck());
                }
            }, []);

            useEffect(() => {
                const gameState = { mode, deck, history, isGameFinished, currentCard };
                localStorage.setItem('brizGameState_v8', JSON.stringify(gameState));
            }, [mode, deck, history, isGameFinished, currentCard]);

            const resetGame = () => {
                localStorage.removeItem('brizGameState_v8');
                setMode('menu');
                setDeck(generateDeck());
                setHistory([]);
                setGameFinished(false);
                setCurrentCard(null);
                setShowResetModal(false);
            };

            const drawVirtualCard = useCallback(() => {
                if (deck.length > 0) {
                    const card = deck[0];
                    const question = questions[card.suit][card.value][0];
                    setHistory(prev => [{ card, question, qIndex: 0 }, ...prev]);
                    setDeck(d => d.slice(1));
                }
            }, [deck]);

            useEffect(() => {
                if (mode === 'virtual' && history.length === 0 && !isGameFinished && deck.length > 0) {
                    drawVirtualCard();
                }
            }, [mode, history.length, isGameFinished, drawVirtualCard, deck.length]);

            const handlePhysicalCardSelection = (card) => {
                const question = questions[card.suit][card.value][0];
                const newItem = { card, question, qIndex: 0 };
                setCurrentCard(newItem);
                setHistory(prev => [newItem, ...prev]);
            };
            
            const addQuickPlayQuestionToHistory = useCallback((question, suit) => {
                const newItem = {
                    card: { suit, value: '‚ö°Ô∏è' },
                    question,
                    qIndex: 0
                };
                setHistory(prev => [newItem, ...prev]);
            }, []);

            const cycleQuestion = () => {
                const activeItem = mode === 'physical' ? currentCard : history[0];
                if (!activeItem || activeItem.card.value === '‚ö°Ô∏è') return;

                const { card, qIndex } = activeItem;
                const questionPool = questions[card.suit][card.value];
                const newQIndex = (qIndex + 1) % questionPool.length;
                const newQuestion = questionPool[newQIndex];
                
                const newItem = { card, question: newQuestion, qIndex: newQIndex };

                if (mode === 'physical') {
                    setCurrentCard(newItem);
                    setHistory(prev => [newItem, ...prev.slice(1)]);
                } else {
                    setHistory(prev => [newItem, ...prev.slice(1)]);
                }
            };
            
            const handleNextQuestion = () => {
                if (mode === 'virtual') {
                    if (deck.length === 0) {
                        setGameFinished(true);
                    } else {
                        drawVirtualCard();
                    }
                } else {
                    setCurrentCard(null);
                }
            };

            const renderContent = () => {
                if (isGameFinished) return <EndGameScreen onRestart={resetGame} />;

                const activeItem = mode === 'physical' ? currentCard : history[0];

                if ((mode === 'virtual' || mode === 'physical') && activeItem) {
                    return <QuestionDisplay historyItem={activeItem} onNext={handleNextQuestion} onCycleQuestion={cycleQuestion} isLastCard={deck.length === 0 && mode === 'virtual'} onThemeClick={() => setShowThemeModal(true)} />;
                }
                
                switch (mode) {
                    case 'physical': return <PhysicalMode onCardSelect={handlePhysicalCardSelection} />;
                    case 'quickplay': return <QuickPlayMode onThemeClick={() => setShowThemeModal(true)} onNewQuestion={addQuickPlayQuestionToHistory} />;
                    case 'menu': default: return <Menu onSelectMode={setMode} onShowRules={() => setShowThemeModal(true)} />;
                }
            };

            return (
                <main className="bg-gray-900 min-h-screen w-full flex flex-col items-center justify-center p-4 font-sans relative">
                    <div className="absolute top-4 w-full flex justify-between items-center px-4 max-w-4xl mx-auto">
                        {mode !== 'menu' && !isGameFinished ? (<button onClick={() => setShowResetModal(true)} className="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-full shadow-lg z-10">&larr; Menu</button>) : <div/>}
                        {mode === 'virtual' && !isGameFinished && (<div className="text-gray-300 text-lg font-semibold bg-gray-700 px-4 py-2 rounded-full z-10">Cartes : {deck.length}</div>)}
                        {mode !== 'menu' && history.length > 0 && !isGameFinished ? (<button onClick={() => setShowHistory(true)} className="bg-gray-700 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-full shadow-lg z-10">Historique</button>) : <div/>}
                    </div>
                    
                    {showHistory && <History history={history} onClose={() => setShowHistory(false)} />}
                    {showResetModal && <ConfirmationModal onConfirm={resetGame} onCancel={() => setShowResetModal(false)} />}
                    {showThemeModal && <ThemeModal onClose={() => setShowThemeModal(false)} />}
                    
                    <div className="w-full flex-grow flex items-center justify-center">{renderContent()}</div>
                    <footer className="w-full text-center text-gray-600 text-sm py-4">Fait avec ‚ô•Ô∏è pour des soir√©es m√©morables.</footer>
                </main>
            );
        }

        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
